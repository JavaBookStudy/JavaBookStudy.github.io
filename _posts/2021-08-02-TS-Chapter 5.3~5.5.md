---
title: "[í† ë¹„ì˜ ìŠ¤í”„ë§] Week7(5.3~5.5)"
subtitle: í† ë¹„ì˜ ìŠ¤í”„ë§ 7ì£¼ì°¨
date: 2021-08-07 20:23:24 +0900
author: taxol
toc: 
categories: í† ë¹„ì˜_ìŠ¤í”„ë§
tags:
  - í† ë¹„ì˜_ìŠ¤í”„ë§
toc: true
toc_sticky: true
---

# 5.3 ì„œë¹„ìŠ¤ ì¶”ìƒí™”ì™€ ë‹¨ì¼ ì±…ì„ ì›ì¹™

> ê¸°ìˆ ê³¼ ì„œë¹„ìŠ¤ì— ëŒ€í•œ ì¶”ìƒí™” ê¸°ë²•ì„ ì‚¬ìš©í•˜ë©´ íŠ¹ì • ê¸°ìˆ í™˜ê²½ì— ì¢…ì†ë˜ì§€ ì•ŠëŠ” ì½”ë“œë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

## ìˆ˜ì§, ìˆ˜í‰ ê³„ì¸µêµ¬ì¡°ì™€ ì˜ì¡´ê´€ê³„

### ìˆ˜í‰ê´€ê³„

`UserDao`ì™€ `UserService`ëŠ” ê°ê° ë‹´ë‹¹í•˜ëŠ” ì½”ë“œì˜ ê¸°ëŠ¥ì ì¸ ê´€ì‹¬ì— ë”°ë¼ ë¶„ë¦¬ë˜ê³ , ì„œë¡œ ë¶ˆí•„ìš”í•œ ì˜í–¥ì„ ì£¼ì§€ ì•Šìœ¼ë©´ì„œ ë…ìì ìœ¼ë¡œ í™•ì¥ì´ ê°€ëŠ¥í•˜ë„ë¡ í•˜ëŠ”, ê°™ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§ì„ ë‹´ì€ ì½”ë“œì§€ë§Œ ê°ìì˜ ê´€ì‹¬ì‚¬(ë‚´ìš©)ì— ë”°ë¼ ë‚˜ë‰˜ì–´ì§„ ìˆ˜í‰ì ì¸ ë¶„ë¦¬ì´ë‹¤.

### ìˆ˜ì§ê´€ê³„

íŠ¸ëœì­ì…˜ ì¶”ìƒí™”ì˜ ê²½ìš°ëŠ” ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ê³¼ ê·¸ í•˜ìœ„ì—ì„œ ë™ì‘í•˜ëŠ” íŠ¸ëœì­ì…˜ ê¸°ìˆ ì´ë¼ëŠ” ë‹¤ë¥¸ ê³„ì¸µì˜ íŠ¹ì„±ì„ ê°–ëŠ” ìˆ˜ì§ì  ë¶„ë¦¬ ê´€ê³„ë¼ê³  í•  ìˆ˜ ìˆë‹¤.

ìˆ˜í‰ì  ë¶„ë¦¬ì´ë“  ìˆ˜ì§ì  ë¶„ë¦¬ì´ë“  ëª¨ë‘ ìŠ¤í”„ë§ì˜ DIê°€ ê·¸ ì—­í• ì„ ë‹´ë‹¹

### ë‹¨ì¼ ì±…ì„ ì›ì¹™

> í•˜ë‚˜ì˜ ëª¨ë“ˆì€ í•œ ê°€ì§€ ì±…ì„ì„ ê°€ì ¸ì•¼í•œë‹¤.

ì¦‰, í•˜ë‚˜ì˜ ëª¨ë“ˆì´ ë°”ë€ŒëŠ” ì´ìœ ëŠ” í•œê°€ì§€ì—¬ì•¼ í•œë‹¤.  
ë‹¨ì¼ ì±…ì„ ì›ì¹™ì„ ì˜ ì§€í‚¤ê²Œ ë˜ë©´ ë³€ê²½ì´ í•„ìš”í•  ë•Œ ìˆ˜ì • ëŒ€ìƒì´ ëª…í™•í•´ì§„ë‹¤.

### Springì—ì„œ DIë¥¼ ì‚¬ìš©í•  ë•Œì˜ ì¥ì 

ìœ ì§€ë³´ìˆ˜ê°€ ì•„ì£¼ ê°„í¸í•´ì§„ë‹¤.

DIê°€ ì•„ë‹Œ ì¢…ì†ì ì´ê³  ì˜ì¡´ì ì¸ ì½”ë“œë“¤ë¡œ ì´ë£¨ì–´ì ¸ìˆë‹¤ë©´, ìˆ˜í‰ì ì´ë“  ìˆ˜ì§ì  ì˜ì¡´ê´€ê³„ì´ë“  ìˆ˜ì •í•´ì•¼ í•  ë¶€ë¶„ì´ ì˜ì¡´ì„ í•˜ê³  ìˆëŠ” ì„œë¹„ìŠ¤ì™€ ê·¸ ë©”ì†Œë“œ ê°¯ìˆ˜ ë§Œí¼ ì¦ê°€í•˜ê²Œ ëœë‹¤.

```
ê°ì²´ì§€í–¥ ì„¤ê³„ì™€ í”„ë¡œê·¸ë˜ë°ì˜ ì›ì¹™ì€ ì„œë¡œ ê¸´ë°€í•˜ê²Œ ê´€ë ¨ì´ ìˆë‹¤. ë‹¨ì¼ ì±…ì„ ì›ì¹™ì„ ì˜ ì§€í‚¤ëŠ” ì½”ë“œë¥¼ ë§Œë“¤ë ¤ë©´ ì¸í„°í˜ì´ìŠ¤ë¥¼ ë„ì…í•˜ê³  ì´ë¥¼ DIë¡œ ì—°ê²°í•´ì•¼ í•˜ë©°, ê·¸ ê²°ê³¼ë¡œ ë‹¨ì¼ ì±…ì„ ì›ì¹™ë¿ ì•„ë‹ˆë¼ ê°œë°© íì‡„ ì›ì¹™ë„ ì˜ ì§€í‚¤ê³ , ëª¨ë“ˆ ê°„ì— ê²°í•©ë„ê°€ ë‚®ì•„ì„œ ì„œë¡œì˜ ë³€ê²½ì´ ì˜í–¥ì„ ì£¼ì§€ ì•Šê³ , ê°™ì€ ì´ìœ ë¡œ ë³€ê²½ì´ ë‹¨ì¼ ì±…ì„ì— ì§‘ì¤‘ë˜ëŠ” ì‘ì§‘ë„ ë†’ì€ ì½”ë“œê°€ ë‚˜ì˜¤ê²Œ ëœë‹¤. ì´ëŸ° ê³¼ì •ì—ì„œ ìì—°ìŠ¤ëŸ½ê²Œ ë””ìì¸ íŒ¨í„´ì´ ì ìš©ë˜ê¸°ë„ í•œë‹¤
```

# ë©”ì¼ ì„œë¹„ìŠ¤ ì¶”ìƒí™”

> "ë ˆë²¨ì´ ì˜¬ë¼ê°€ë©´ ì‚¬ìš©ìì—ê²Œ ì´ë©”ì¼ë¡œ ì•Œë ¤ì£¼ì„¸ìš”!"

User í…Œì´ë¸”ì— email ì¹¼ëŸ¼ì„ ì¶”ê°€í•˜ê³ , í•´ë‹¹ í”„ë¡œí¼í‹°ì™€ ë©”ì„œë“œì— ê¸°ëŠ¥ ì¶”ê°€í•œë‹¤.  
ì´í›„ì—ëŠ” ìë°”ì—ì„œ ì œê³µí•´ì£¼ëŠ” JavaMailì„ ì´ìš©í•´ì„œ ë©”ì¼ ë°œì†¡ ê¸°ëŠ¥ì„ ì¶”ê°€.

## JavaMailì´ í¬í•¨ëœ ì½”ë“œì˜ í…ŒìŠ¤íŠ¸, í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ì„œë¹„ìŠ¤ ì¶”ìƒí™”

ë§¤ë²ˆ ë©”ì¼ì´ ë°œì†¡ë˜ëŠ” ê²ƒì€ í…ŒìŠ¤íŠ¸ë¡œì¨ ë°”ëŒì§í•˜ì§€ ëª»í•˜ë‹¤. ë©”ì¼ ë°œì†¡ì€ ë¶€í•˜ê°€ ë§¤ìš° í¬ê¸° ë•Œë¬¸

JavaMailì€ ìë°”ì˜ í‘œì¤€ ê¸°ìˆ ì´ê³  ê²€ì¦ëœ ì•ˆì •ì ì¸ ëª¨ë“ˆì´ë¯€ë¡œ, JavaMailì˜ ë™ì‘í•˜ë©´ ì„±ê³µì ìœ¼ë¡œ ë©”ì¼ì´ ë°œì†¡ ë˜ì—ˆë‹¤ê³  ìƒê°í•˜ì.

### JavaMailì„ ì´ìš©í•œ í…ŒìŠ¤íŠ¸ì˜ ë¬¸ì œì 

JavaMailì˜ APIëŠ” êµ¬í˜„ í´ë˜ìŠ¤ì´ë¯€ë¡œ ì¶”ìƒí™”ë¥¼ í•˜ì§€ ëª»í•œë‹¤.

-> ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” ë©”ì¼ ì„œë¹„ìŠ¤ ì¶”ìƒí™” ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©

```java
public interface MailSender{
  void send(SimpleMailMessage simpleMessage) throws MailException;
  void send(SimpleMailMessage[] simpleMessage) throws MailException;
}
```

```java
private void sendUpgradeEmail(User user) {
  JavaMailSenderImpl mailSender = new JavaMailSenderImpl();
  mailSender.setHost("mail.server.com");

  SimpleMailMessage mailMessage = new SimpleMailMessage();
  mailMessage.setTo(user.getEmail());
  mailMessage.setFrom("useradmin@ksug.org");
  mailMessage.setSubject("Upgrade ì•ˆë‚´");
  mailMessage.setText("ì‚¬ìš©ìë‹˜ì˜ ë“±ê¸‰ì´ " + user.getLevel().name());

  mailSender.send(mailMessage);
}
```

ìœ„ ì½”ë“œëŠ” ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” MailSender ì¸í„°í˜ì´ìŠ¤ë¥¼ ì´ìš©í•˜ì—¬ ë©”ì¼ ì „ì†¡ ì„œë¹„ìŠ¤ë¥¼ ì¶”ìƒí™” í•˜ì˜€ë‹¤.

`JavaMailSenderImpl`ëŠ” ì‹¤ì œ ë©”ì¼ì„ ì „ì†¡í•˜ëŠ” ì˜¤ë¸Œì íŠ¸ ì´ë¯€ë¡œ, ì´ë¥¼ í…ŒìŠ¤íŠ¸ìš© ì˜¤ë¸Œì íŠ¸ë¡œ ë³€ê²½í•˜ì.

```java
// ì‹¤ì œ simpleMessageë¡œ ë¶€í„° ë©”ì¼ì„ ë°›ì•„ ì „ì†¡í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ dummy ì „ì†¡ ê°ì²´
public class DummyMailSender implements MailSender {
	@Override
	public void send(SimpleMailMessage simpleMessage) throws MailException {
	}

	@Override
	public void send(SimpleMailMessage[] simpleMessages) throws MailException {
	}
}
```

ìœ„ ë”ë¯¸ ê°ì²´ë¥¼ DI í•´ì£¼ì.

```xml

	<bean id="userService" class ="com.taxol.service.UserService">
		<property name="userDao" ref="userDao"/>
		<property name="transactionManager" ref="transactionManager"></property>
		<property name="mailSender" ref="mailSender"/>
	</bean>

	<bean id="mailSender" class = "com.taxol.service.DummyMailSender"/>
```

ì´í›„ userServiceTestì— ìˆ˜ë™ DI í•´ì£¼ë©´ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•œë‹¤.

```java

@Autowired
MailSender mailSender;

@Test
	public void upgradeAllOrNothing() throws Exception {
		UserService testUserService = new TestUserService(users.get(3).getId());
		testUserService.setUserDao(userDao);
		testUserService.setDataSource(dataSource);
		testUserService.setTransactionManager(transactionManager);
		testUserService.setMailSender(mailSender);	// UserServiceë¥¼ ìœ„í•œ ë©”ì¼ ì „ì†¡ ì˜¤ë¸Œì íŠ¸ ìˆ˜ë™ DI

		userDao.deleteAll();

		for (User user : users) {
			userDao.add(user);
		}

		try {
			testUserService.upgradeLevels();
			fail("TestUserServiceException expected");
		} catch (TestUserServiceException e) {
		}

	}
```

### í…ŒìŠ¤íŠ¸ì™€ ì„œë¹„ìŠ¤ ì¶”ìƒí™”

> ì„œë¹„ìŠ¤ ì¶”ìƒí™”

ì¼ë°˜ì ìœ¼ë¡œ ê¸°ëŠ¥ì€ ìœ ì‚¬í•˜ë‚˜ ì‚¬ìš© ë°©ë²•ì´ ë‹¤ë¥¸ ë¡œìš°ë ˆë²¨ì˜ ë‹¤ì–‘í•œ ê¸°ìˆ ì— ëŒ€í•´ ì¼ê´€ì„± ìˆëŠ” ì ‘ê·¼ ë°©ë²•ì„ ì œê³µí•˜ëŠ” ê²ƒì„ ì˜ë¯¸  
`JavaMail`ê³¼ ê°™ì´ í…ŒìŠ¤íŠ¸ë¥¼ ì–´ë µê²Œ ë§Œë“œëŠ” APIë¥¼ ì‚¬ìš©í•  ë•Œë„ ìœ ìš©í•˜ê²Œ ì‚¬ìš©ë¨  
`JavaMail`ì´ ì•„ë‹Œ ë‹¤ë¥¸ ë©”ì„¸ì§• ì„œë²„ì˜ APIë¥¼ ì´ìš©í•˜ëŠ” ê²½ìš°ì—ë„ `MailSender` êµ¬í˜„ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì„œ DI í•´ì£¼ë©´ ë¨  
ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ë°”ë€Œì§€ ì•ŠëŠ” í•œ `UserService`ëŠ” ìˆ˜ì •í•  í•„ìš”ê°€ ì—†ìŒ

ğŸ¤”ë¬¸ì œì  : íŠ¸ëœì­ì…˜ ê°œë…ì´ ë¹ ì ¸ìˆìŒ

ë ˆë²¨ ì—…ê·¸ë ˆì´ë“œì— íŠ¸ëœì­ì…˜ì´ ì ìš©ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ë©”ì¼ ë°œì†¡ ê¸°ëŠ¥ì—ë„ íŠ¸ëœì­ì…˜ì„ ì ìš©í•´ì•¼ í•¨

-> í•´ê²° ë°©ì•ˆ

1. ë°œì†¡ ëŒ€ìƒì„ ë³„ë„ì˜ ëª©ë¡ì— ì €ì¥ : ì‚¬ìš©ì ê´€ë¦¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ ë©”ì¼ ë°œì†¡ íŠ¸ëœì­ì…˜ ê¸°ìˆ  ë¶€ë¶„ì´ ì„ì„
2. MailSenderë¥¼ í™•ì¥í•´ì„œ ë©”ì¼ ì „ì†¡ì— íŠ¸ëœì­ì…˜ ê°œë…ì„ ì ìš© : ì„œë¡œ ë‹¤ë¥¸ ì¢…ë¥˜ì˜ ì‘ì—…ì„ ë¶„ë¦¬í•´ ì²˜ë¦¬ê°€ ê°€ëŠ¥

## í…ŒìŠ¤íŠ¸ ëŒ€ì—­

- í…ŒìŠ¤íŠ¸ìš© DB / DummyMail
- í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ ìœ ìš©í•˜ê²Œ ì‚¬ìš© ê°€ëŠ¥

### í…ŒìŠ¤íŠ¸ í•  ëŒ€ìƒì´ ì˜ì¡´í•˜ê³  ìˆëŠ” ì˜¤ë¸Œì íŠ¸ë¥¼ DIë¥¼ í†µí•´ ë°”ê¿”ì¹˜ê¸° í•¨

#### UserDao

UserDaoëŠ” ìš´ì˜ ì‹œìŠ¤í…œì—ì„œ ì‚¬ìš©í•˜ëŠ” DBì™€ ì—°ê²°ë¼ì„œ ë™ì‘í•¨  
-> í…ŒìŠ¤íŠ¸ì—ì„œëŠ” ìš´ì˜ DBì˜ ì—°ê²°ì´ë‚˜ WASì˜ DB í’€ë§ ì„œë¹„ìŠ¤ëŠ” ë²ˆê±°ë¡­ë‹¤.
ê·¸ëŸ¼ì—ë„ ë¶ˆêµ¬í•˜ê³  DBëŠ” ë°˜ë“œì‹œ ìˆì–´ì•¼ í•˜ë¯€ë¡œ ê°€ë²¼ìš´ ë²„ì „ì„ ì´ìš©

#### UserService

UserServiceëŠ” ë©”ì¼ ì „ì†¡ ê¸°ëŠ¥ì„ ì´ìš©

ë©”ì¼ ì „ì†¡ ê¸°ëŠ¥ì„ ì•„ì˜ˆ ë—„ ìˆ˜ëŠ” ì—†ìŒ
í…ŒìŠ¤íŠ¸ì— ì§€ì¥ì„ ì£¼ì§€ ì•Šê¸° ìœ„í•´ DummyMailSenderë¥¼ ë„ì…

ì˜ì¡´ì´ë€ ì¢…ì†ë˜ê±°ë‚˜ ê¸°ëŠ¥ì„ ì‚¬ìš©í•œë‹¤ëŠ” ì˜ë¯¸
ê°„ë‹¨í•œ ì˜¤ë¸Œì íŠ¸ì˜ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ë„ˆë¬´ ë§ì€ ì‘ì—…ì´ ë’¤ ë”°ë¦„

ğŸ¥°í•´ê²°ì±…

UserDao : í™˜ê²½ ìì²´ë¥¼ ê°„ë‹¨í•œê²Œ ë§Œë“¬
UserService : ì•„ë¬´ëŸ° ì¼ë„ í•˜ì§€ ì•ŠëŠ” ë¹ˆ ì˜¤ë¸Œì íŠ¸ë¡œ ëŒ€ì²´

## í…ŒìŠ¤íŠ¸ ëŒ€ì—­ì˜ ì¢…ë¥˜ì™€ íŠ¹ì§•

âš¾í…ŒìŠ¤íŠ¸ ëŒ€ì—­ : í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” íŠ¹ë³„í•œ ì˜¤ë¸Œì íŠ¸

- ëŒ€ë¶€ë¶„ í…ŒìŠ¤íŠ¸ ëŒ€ìƒì¸ ì˜¤ë¸Œì íŠ¸ì˜ ì˜ì¡´ ì˜¤ë¸Œì íŠ¸
- UserDaoì˜ DataSource, UserServiceì˜ DummyMailSender

âš¾í…ŒìŠ¤íŠ¸ ìŠ¤í… : ëŒ€í‘œì ì¸ í…ŒìŠ¤íŠ¸ ëŒ€ì—­

- í…ŒìŠ¤íŠ¸ ëŒ€ìƒ ì˜¤ë¸Œì íŠ¸ì˜ ì˜ì¡´ê°ì²´
- í…ŒìŠ¤íŠ¸ ë™ì•ˆ ì½”ë“œê°€ ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰í•  ìˆ˜ ìˆë„ë¡ ë•ëŠ” ê²ƒ
- DIë¥¼ í†µí•´ ì˜ì¡´ ì˜¤ë¸Œì íŠ¸ë¥¼ í…ŒìŠ¤íŠ¸ ìŠ¤í…ìœ¼ë¡œ ë³€ê²½í•´ì•¼ í•¨

### ëª© ì˜¤ë¸Œì íŠ¸ë¥¼ ì´ìš©í•œ í…ŒìŠ¤íŠ¸

ğŸ¤·â€â™‚ï¸ëª© ì˜¤ë¸Œì íŠ¸ë€?  
í…ŒìŠ¤íŠ¸ ëŒ€ìƒ ì˜¤ë¸Œì íŠ¸ì˜ ë©”ì†Œë“œê°€ ëŒë ¤ì£¼ëŠ” ê²°ê³¼ë¿ ì•„ë‹ˆë¼ í…ŒìŠ¤íŠ¸ ì˜¤ë¸Œì íŠ¸ê°€ ê°„ì ‘ì ìœ¼ë¡œ ì˜ì¡´ ì˜¤ë¸Œì íŠ¸ì— ë„˜ê¸°ëŠ” ê°’ê³¼ ê·¸ í–‰ìœ„ ìì²´ì— ëŒ€í•´ì„œë„ ê²€ì¦í•˜ê³  ì‹¶ì€ ê²½ìš°ì— ì‚¬ìš©

ì‰½ê²Œ ì–˜ê¸°í•´ì„œ í…ŒìŠ¤íŠ¸ ì½”ë“œì—ì„œëŠ” ìš°ë¦¬ê°€ í…ŒìŠ¤íŠ¸ë¥¼ í•˜ê¸°ë¡œ í•œ ì˜¤ë¸Œì íŠ¸ì˜ ê²°ê³¼ê°’ë§Œì„ ë°›ì•„ì˜¤ëŠ”ë°, í…ŒìŠ¤íŠ¸ ì˜¤ë¸Œì íŠ¸ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì˜ì¡´ ì˜¤ë¸Œì íŠ¸ì— ê°’ì„ ì˜ ì „ë‹¬í•˜ê³  ë°˜í™˜ì´ ì˜ ë˜ëŠ”ì§€ì— ëŒ€í•œ ê²ƒì„ ê²€ì‚¬í•  ë•Œ ì‚¬ìš©í•œë‹¤.

```java
public class UserServiceTest {
  static class MockMailSender implements MailSender {
    // UserServiceë¡œë¶€í„° ì „ì†¡ ìš”ì²­ì„ ë°›ì€ ë©”ì¼ ì£¼ì†Œë¥¼ ì €ì¥í•´ë‘ê³  ì´ë¥¼ ì½ì„ ìˆ˜ ìˆê²Œ í•œë‹¤.
    private List<String> requests = new ArrayList<String>();

    public List<String> getRequests() {
      return requests;
    }

    @Override
    public void send(SimpleMailMessage mailMessage) throws MailException {
      // ì „ì†¡ ìš”ì²­ì„ ë°›ì€ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì €ì¥í•´ë‘”ë‹¤.
      // ê°„ë‹¨í•˜ê²Œ ì²« ë²ˆì§¸ ìˆ˜ì‹ ì ë©”ì¼ ì£¼ì†Œë§Œ ì €ì¥í–ˆë‹¤.
      requests.add(mailMessage.getTo()[0]);
    }

    @Override
    public void send(SimpleMailMessage... mailMessage) throws MailException {
    }
  }
}
```

```java
@Test
@DirtiesContext
public void upgradeLevels() {
  userDao.deleteAll();
  for(User user : users) userDao.add(user);

  // ë©”ì¼ ë°œì†¡ ê²°ê³¼ë¥¼ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆë„ë¡ ëª© ì˜¤ë¸Œì íŠ¸ë¥¼ ë§Œë“¤ì–´ userServiceì˜ ì˜ì¡´ ì˜¤ë¸Œì íŠ¸ë¡œ ì£¼ì…í•œë‹¤.
  MockMailSender mockMailSender = new MockMailSender();
  userService.setMailSender(mockMailSender);

  userService.upgradeLevels();

  // ê° ì‚¬ìš©ìë³„ë¡œ ì—…ê·¸ë ˆì´ë“œ í›„ì˜ ì˜ˆìƒ ë ˆë²¨ì„ ê²€ì¦í•œë‹¤.
  checkLevelUpgraded(users.get(0), false);
  checkLevelUpgraded(users.get(1), true);
  checkLevelUpgraded(users.get(2), false);
  checkLevelUpgraded(users.get(3), true);
  checkLevelUpgraded(users.get(4), false);

  // ëª© ì˜¤ë¸Œì íŠ¸ì— ì €ì¥ëœ ë©”ì¼ ìˆ˜ì‹ ì ëª©ë¡ì„ ê°€ì ¸ì™€ ì—…ê·¸ë ˆì´ë“œ ëŒ€ìƒê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸ í•œë‹¤.
  List<String> request = mockMailSender.getRequests();
  assertThat(request.size(), is(2));
  assertThat(request.get(0), is(users.get(1).getEmail()));
  assertThat(request.get(1), is(users.get(3).getEmail()));
}
```

ğŸ‘»í…ŒìŠ¤íŠ¸ í”„ë¡œì„¸ìŠ¤

1. DummyMailSenderë¥¼ ëŒ€ì‹ í•´ì„œ ì‚¬ìš©í•  ë©”ì¼ ì „ì†¡ ê²€ì¦ìš© ëª© ì˜¤ë¸Œì íŠ¸ë¥¼ ì¤€ë¹„
2. MockMailSender ì˜¤ë¸Œì íŠ¸ ìƒì„± í›„ ìˆ˜ë™ DI
3. ëª© ì˜¤ë¸Œì íŠ¸ë¡œë¶€í„° getRequests()ë¥¼ í˜¸ì¶œí•´ì„œ ë©”ì¼ ì£¼ì†Œê°€ ì €ì¥ëœ ë¦¬ìŠ¤íŠ¸ë¥¼ ê°€ì ¸ì˜´
4. ë‘ ë²ˆì§¸ì™€ ë„¤ ë²ˆì§¸ ìœ ì €ê°€ ì—…ê·¸ë ˆì´ë“œê°€ ë˜ì—ˆê³ , ë©”ì¼ì´ ë°œì†¡ë˜ì—ˆìŒì„ í™•ì¸
