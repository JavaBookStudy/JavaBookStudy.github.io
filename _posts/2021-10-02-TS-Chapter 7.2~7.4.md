---
title: "[토비의 스프링] Week11(7.2~7.4)"
subtitle: 토비의 스프링 11주차
date: 2021-10-02 20:23:24 +0900
author: integerjs
toc: 
categories: 토비의_스프링
tags:
  - 토비의_스프링
toc: true
toc_sticky: true
---

> 토비의 스프링 3.1 Chapter 7.2 ~ 7.4

# 7.2 인터페이스의 분리와 자기참조 빈  

## JAXB: Java Architecture for XML Binding  
: XML에 담긴 정보를 파일에서 읽어 오는 방법

- XML 문서 정보를 거의 동일한 구조의 오브젝트로 직접 매핑한다.

- 어노테이션에 담긴 정보를 이용해 XML과 매핑된 오브젝트 트리 사이의 자동변환 작업을 수행해준다.

> 마샬링(marshalling) : 바인딩 오브젝트를 XML 문서로 변환하는 것  
> 언마샬링(unmarshalling) : XML 문서를 읽어서 자바의 오브젝트로 변환하는 것

### 사용 방법

```
JAXContext context = JAXBContext.newInstance(컨텍스트패스);
Unmarshaller unmarchaller = context.createUnmarshaller(); // 언마샬러 생성

Sqlmap sqlmap = (Sqlmap) unmarshaller.unmarshal(getClass.().getResourceAsStream("sqlmap.xml")); // xml 파일에 있는 정보를 Sqlmap에 매핑시킨다.

List<SqlType> sqlList = sqlmap.getSql();
```

- 특별한 이유가 없는 한 XML 파일은 한 번만 읽도록 하자. 

### 외부에서 XML 파일을 지정하는 방법  

생성자에서 XML 파일 이름을 지정하던 것을 별도의 초기화 메서드를 만들어 옮겨 놓는다.   
application.xml(또는 빈 설정 property 태그)를 이용해 값을 지정해주면 된다.  

## @PostConstruct  
빈 오브젝트의 초기화 메서드를 지정하는 데 사용한다.

-> 스프링은 빈 오브젝트를 생성하고 DI 작업을 마친 뒤에 @PostConstruct가 붙은 메서드를 자동으로 실행해준다.  
-> 일반 생성자와는 달리 프로퍼티까지 모두 준비된 후에 실행된다.

### 스프링 컨테이너의 초기 작업 순서  
1. applicationContext.xml에서 빈 설정을 읽는다.
2. 빈의 객체를 생성한다.
3. 프로퍼티에 의존 객체 또는 값을 주입한다.
4. 빈이나 태그로 등록된 후처리기를 동작시킨다.
5. 코드에 달린 어노테이션에 대한 부가작업을 진행한다. (@PostConstruct가 여기서 실행된다.)

## 인터페이스 분리  
책임에 따라 XmlSqlService 인터페이스를 분리 한다.

책임 1: SQL 정보를 외부의 리소스로부터 읽어 온다. -> SqlReader  
책임 2: 읽어온 SQL을 보관해두고 있다가 필요할 때 제공해준다. -> SqlRegistry  
책임 3: XML에서 읽어온 SQL 정보를 관리 -> SqlService

SqlService가 SqlReader에게 Sql을 가져오라고 요청하고, SqlReader는 SqlRegistry에 sql을 등록하며, SqlService는 SqlRegistry에서 Sql을 검색할 수 있게 된다.

## 자기참조 빈
책임과 관심사가 복잡하게 얽혀 잇어서 확장이 힘들고 변경에 취약한 구조의 클래스를 유연한 구조롤 만들려고 할 때 사용할 수 있는 방법.

-> 일단 인터페이스를 통해 책임과 역할을 구분해두고 자기 자신을 참조하거나 DI한다.  

## 디폴트 의존관계  
외부에서 DI 받지 않는 경우 기본적으로 자동 적용되는 의존 관계.  
생성자에서 디폴트 의존 객체를 직접 만들어소 스스로 주입해준다.  
다른 명시적인 설정이 있다면, 그 설정을 따른다.

```
public class JaxbXmlSqlReader implements SqlReader {
	private static final String DEFAULT_SQLMAP_FILE = "sqlmap.xml";

	private String sqlmapFile = DEFAULT_SQLMAP_FILE;

	// 다른 설정이 없으면 여기서 지정한 파일이 사용된다.
	public void setSqlmapFile(String sqlmapFile) { this.sqlmapFile = sqlmapFile; }
}
```

